---
title: "Домашнее задание 4"
output: html_document
---

Большинство задач в домашнем задании по R предполагают автоматическое тестирование кода. Если хотите пользоваться встроенными в файл тестами, установите с Github библиотеку `testrmd` (достаточно установить один раз для всех последующих заданий):

```{r, eval=FALSE}
install.packages("devtools")
devtools::install_github("ropenscilabs/testrmd")
```

Для того, чтобы автоматические тесты работали, исполните следующую строчку кода:

```{r}
testrmd::init()
```

Тесты работают так: при связывании текущего Rmd-файла в готовом html-файле отображаются включения с информацией о пройденных тестах. Если какие-то тесты не пройдены, рядом с блоком с решением задачи появляется красная кнопка, а в начале файла появляется предупреждение вида `Warning! This document contains N failing tests`. Можно кликнуть на красную кнопку и посмотреть, такие тесты не пройдены и почему.

####Задача 1

Два события $A$ и $B$ являются независимыми, если выполняется условие $P(A \cap B) = P(A) \times P(B)$. Напишите код, который запрашивает у пользователя с клавиатуры вероятности событий $A$ и $B$ и вероятность их пересечения (одна вероятность — один ввод) и проверяет, являются ли события $A$ и $B$ независимыми, то есть сохраняет и выводит на экран логическое значение `TRUE` или `FALSE`.

**Пример 1**

```
Enter P(A): 0.4
Enter P(B): 0.5
Enter P(A and B): 0.2
[1] TRUE
```

**Пример 2**

```
Enter P(A): 0.3
Enter P(B): 0.1
Enter P(A and B): 0.2
[1] FALSE
```

```{r code1}
probs <- function(){
  ### BEGIN YOUR CODE
  
  
  ### END YOUR CODE
}
probs()
```

```{r test_chunk1, test = TRUE, echo = FALSE}
print("Test: if fail, your code does not print a logical value.", quote = FALSE)
test.1 <- probs()
stopifnot(is.logical(test.1), TRUE)
```

####Задача 2

Напишите код, который запрашивает у пользователя с клавиатуры значения дискретной случайной величины через пробел, потом запрашивает соответствующие значениям вероятности через пробел, и выводит на экран математическое ожидание и дисперсию этой величины.

**Пример**

```
Enter values: -1 0 3
Enter probabilities: 0.4 0.1 0.5
E(X) = 1.1 and D(X) = 3.8
```

**Напоминание.** Математическое ожидание — ожидаемое среднее значение случайной величины — вычисляется следующим образом:

$$
E(X)=\sum\limits_{i=1}^{n}x_ip_i = x_1p_1 + x_2p_2 + \dots + x_np_n.
$$

Другими словами, перемножаем значения и соответствующие им вероятности, а потом все суммируем).

Дисперсия — показатель разброса значений случайной величины относительно ожидаемого среднего значения — вычисляется следующим образом:

$$
D(X)=E(X^2)-[E(X)]^2.
$$
```{r code2}
discreteV <- function(){
  ### BEGIN YOUR CODE
  
  
  ### END YOUR CODE
}
discreteV()
```

####Задача 3

Число действительных бюллетеней на избирательных участках некоторой территориальной избирательной комиссии задается вектором `valid_votes`, а число недействительных бюллетеней — вектором `invalid_votes`. Общее число зарегистрированных избирателей задается вектором `voters`.

```{r}
valid_votes <- c(25, 8, 12, 18, 25, 32, 10, 17, 22, 17)
invalid_votes <- c(1, 0, 4, 3, 9, 2, 0, 5, 1, 0)
voters <- c(50, 75, 62, 54, 98, 55, 72, 80, 44, 48)
```

Создайте вектор `turnout`, который содержит значения явки на избирательных участках, выраженные в процентах и округленные до *второго* знака после запятой.

**Напоминание.** Явка определяется как доля суммы действительных и недействительных бюллетеней от общего числа зарегистрированных избирателей.

```{r code3}
get.turn <- function(){
  valid_votes <- c(25, 8, 12, 18, 25, 32, 10, 17, 22, 17)
  invalid_votes <- c(1, 0, 4, 3, 9, 2, 0, 5, 1, 0)
  voters <- c(50, 75, 62, 54, 98, 55, 72, 80, 44, 48)
  turnout <- c()
  ### BEGIN YOUR CODE
  
  
  ### END YOUR CODE
  turnout
}
get.turn()
```

```{r test_chunk3, test = TRUE, echo = FALSE}
test.3 <- get.turn()

print("Test 1: if fail, the number of elements in a vector is incorrect", quote = FALSE)
stopifnot(length(test.3) == 10, TRUE)

print("Test 2: if fail, values in a vector are incorrect", quote = FALSE)
stopifnot(min(test.3) == 10.67, TRUE)

print("Test 3: if fail, values in a vector are incorrect", quote = FALSE)
stopifnot(sum(test.3) == 352.96, TRUE)
```

####Задача 4

Вектор `ages` представляет собой набор значений возраста респондентов мужского пола, принимавших участие в опросе.

```{r}
ages <- c(23, 18, 19, 33, 36, 27, 68, 62, 78, 45, 42, 38, 55, 16, 14, 17, 92)
```

1. Выберите из вектора `ages` значения, которые соответствуют трудоспособному возрасту (в России для мужчин — с 16 до 59 лет включительно), и сохраните их в вектор `work_age`. Сколько людей такого возраста среди наших респондентов? Сохраните ответ на вопрос в переменную `N1`.

```{r code4.1}
demog1 <- function(){
  ages <- c(23, 18, 19, 33, 36, 27, 68, 62, 
            78, 45, 42, 38, 55, 16, 14, 17, 92)
  N1 <- 0
  ### BEGIN YOUR CODE HERE
  
  
  ### END YOUR CODE HERE
  N1
}
demog1()
```


```{r test_chunk4.1, test = TRUE, echo = FALSE}
test.4.1 <- demog1()
print("Test: if fail, answer is incorrect.", quote = FALSE)
stopifnot(test.4.1 == 12, TRUE)
```


2. Выберите из вектора `ages` значения, которые соответствуют возрасту, младше трудоспособного (в России — менее 16 лет), и сохраните их в вектор `young_age`. Сколько людей такого возраста среди наших респондентов? Сохраните ответ на вопрос в переменную `N1`.

```{r code4.2}
demog2 <- function(){
  ages <- c(23, 18, 19, 33, 36, 27, 68, 62, 
            78, 45, 42, 38, 55, 16, 14, 17, 92)
  N2 <- 0
  ### BEGIN YOUR CODE HERE
  
  
  ### END YOUR CODE HERE
  N2
}
demog2()
```

```{r test_chunk4.2, test = TRUE, echo = FALSE}
test.4.2 <- demog2()
print("Test: if fail, answer is incorrect.", quote = FALSE)
stopifnot(test.4.2 == 1, TRUE)
```

####Задача 5

Политолог Мебейн (Walter R. Mebane) считает, что большая доля избирательных участков со значениями явки, заканчивающихся на 0 или 5, свидетельствует о фальсификациях результатов выборов. Аргументирует он это чисто психологическими причинами: если значения явки сочиняют люди, то они более склонны записывать круглые числа и числа, кратные 5.

Перед вами вектор значений явки на избирательных участках в районе F страны Флатландии:

```{r}
Fturnout <- c(100, 124, 121, 130, 150, 155, 144, 132, 189, 145, 125, 110, 118, 129, 127)
```

Сохраните в вектор `s` индексы избирательных участков, где явка, согласно Мебейну, выглядит подозрительной.

```{r code5}
suspect1 <- function(){
  Fturnout <- c(100, 124, 121, 130, 150, 155, 
                144, 132, 189, 145, 125, 110, 118, 129, 127)
  s <- c()
  ### BEGIN YOUR CODE HERE
  
  
  ### END YOUR CODE HERE
  s
}
suspect1()
```

```{r test_chunk5, test = TRUE, echo = FALSE}
test5 <- suspect1()

print("Tests 1-2: if fail, answer is incorrect", quote = FALSE)
stopifnot(length(test5) == 7, TRUE)
stopifnot(sum(test5) == 49, TRUE)
```

####Задача 6

Известно, что в таблице содержатся показатели по Ивановской области за 8 лет (с 2008 по 2015 включительно). В Ивановской области 21 муниципальный район. Создайте три вектора, которые могут быть использованы в качестве столбцов `region` (название области), `district_id` (номер района) и `year` (год):

а) считая, что сначала идут значения показателей по одному району за 8 лет, потом — по второму за 8 лет и так далее;

```{r code6.1}
ivanovo.a <- function(){
  region <- c()
  district_id <- c()
  year <- c()
  
  ### BEGIN YOUR CODE
  
  
  ### END YOUR CODE
  list(region = region, 
       district_id = district_id, 
       year = year)
}
ivanovo.a()
```

```{r test_chunk6.1, test = TRUE, echo = FALSE}
test.6.1 <- ivanovo.a()

print("Tests 1-3: if fail, the number of elements in vectors is incorrect.", quote = FALSE)
stopifnot(length(test.6.1$region) == length(test.6.1$district_id), TRUE) 
stopifnot(length(test.6.1$district_id) == length(test.6.1$year), TRUE)
stopifnot(length(test.6.1$year) == 168, TRUE)

print("Test 4: if fail, region is specified incorrectly.", quote = FALSE)
stopifnot(length(unique(test.6.1$region)) == 1, TRUE)

print("Tests 5-6: if fail district_id is specified incorrectly.", quote = FALSE)
stopifnot(length(unique(test.6.1$district_id)) == 21, TRUE)
stopifnot(test.6.1$district_id[22] == 3 & test.6.1$district_id[70] == 9, TRUE)

print("Tests 7-8: if fail, year is specified incorrectly.", quote = FALSE)
stopifnot(length(unique(test.6.1$year)) == 8, TRUE)
stopifnot(test.6.1$year[65] == 2008 & test.6.1$year[14] == 2013, TRUE)
```

б) считая, что сначала идут значения показателей по одному году по всем 21 районам, потом — по второму по 21 районам и так далее.

```{r code6.2}
ivanovo.b <- function(){
  region <- c()
  district_id <- c()
  year <- c()
  ### BEGIN YOUR CODE
  
  
  ### END YOUR CODE
  list(region = region, district_id = district_id, year = year)
}
ivanovo.b()
```

```{r test_chunk6.2, test = TRUE, echo = FALSE}
test.6.2 <- ivanovo.b()

print("Tests 1-3: if fail, the number of elements in vectors is incorrect.", quote = FALSE)
stopifnot(length(test.6.2$region) == length(test.6.2$district_id), TRUE) 
stopifnot(length(test.6.2$district_id) == length(test.6.2$year), TRUE)
stopifnot(length(test.6.2$year) == 168, TRUE)

print("Test 4: if fail, region is specified incorrectly.", quote = FALSE)
stopifnot(length(unique(test.6.2$region)) == 1, TRUE)

print("Tests 5-6: if fail district_id is specified incorrectly.", quote = FALSE)
stopifnot(length(unique(test.6.2$district_id)) == 21, TRUE)
stopifnot(test.6.2$district_id[22] == 1 & test.6.2$district_id[70] == 7, TRUE)

print("Tests 7-8: if fail, year is specified incorrectly.", quote = FALSE)
stopifnot(length(unique(test.6.2$year)) == 8, TRUE)
stopifnot(test.6.2$year[65] == 2011 & test.6.2$year[14] == 2008, TRUE)
```

####Задача 7

Создайте матрицу `M`, которая содержит данные по четырем городам (город, численность населения, площадь):

```
Москва, 12 615 279 человек, 2561.5 кв. км
Санкт-Петербург, 5 383 890 человек, 1439 кв. км
Омск, 1 164 815 человек, 566.9 кв. км
Екатеринбург, 1 483 119 человек, 468 кв. км
```

Обратите внимание: в матрице обязательно должны присутствовать названия городов, но при этом числовые данные должны иметь тип `numeric`.

```{r rcode7}
cities <- function(){
  M <- matrix()
  ### BEGIN YOUR CODE
  
  
  ### END YOUR CODE
  M
}
cities()
```

```{r test_chunk7, test = TRUE, echo = FALSE}
test.7 <- cities()

print("Test 1: if fail, incorrect number of dimensions.", quote = FALSE)
stopifnot(nrow(test.7) == 4 & ncol(test.7) == 2, TRUE)

print("Test 2: if fail, matrix is not numeric", quote = FALSE)
stopifnot(is.numeric(test.7), TRUE)

print("Test 3: if fail, incorrect elements in a matrix.", quote = FALSE)
stopifnot(test.7[1, 1] == 12615279 & test.7[3, 2] == 566.9, TRUE)
```

####Задача 8

Напишите код, который принимает на вход числовую матрицу `Nums` (дана в коде для примера) и сохраняет в переменную `rmax` индекс строки, имеющей наибольшую сумму элементов. Если таких строк несколько, то переменная `rmax` будет представлять собой вектор и хранить несколько индексов. 

Ваш код должен корректно работать для матрицы любой размерности. В задаче нельзя использовать условные конструкции и циклы.

**Подсказка.** Для нахождения суммы по каждой строке матрицы в R есть готовая функция `rowSums()`.

```{r code8}
Nums <- matrix(1:12, ncol = 5, byrow = TRUE)

sumsM <- function(Nums){
  rmax <- 0
  ### BEGIN YOUR CODE
  
  
  ### END YOUR CODE
  rmax
}
sumsM(Nums)
```

```{r test_chunk8, test = TRUE, echo = FALSE}
print("Tests 1-2: if fail, your code works incorrectly for matrices that have one row with max sum.", quote = FALSE)
stopifnot(sumsM(matrix(1:7)) == 7, TRUE)
stopifnot(sumsM(matrix(20:35, ncol = 4)) == 4, TRUE)

print("Test 3: if fail, your code works incorrectly for matrices that have several rows with max sum.", quote = FALSE)
stopifnot(sumsM(matrix(rep(1:6, 8), ncol=12)) == c(2, 4), TRUE)
```

####Задача 9

Дан список `Q` с характеристиками мячей для игры в квиддич. Напишите код, который добавит в этот список данные по снитчу: 

* name: snitch, 
* points: 150, 
* who_is_after: seeker.

```{r code9}
quidditch <- function(){
  Q <- list(name = c("quaffle", "bludger"),
  points = c(10, 0),
  who_is_after = c("chaser", "beater"))
  
  ### BEGIN YOUR CODE
  
  
  ### END YOUR CODE
  Q
}
quidditch()
```

```{r test_chunk9, test = TRUE, echo = FALSE}
test.9 <- quidditch()

print("Test 1: if fail, your list or vectors inside it have incorrect number of elements.", quote = FALSE)
stopifnot(length(test.9) == 3, TRUE)
stopifnot(length(test.9$name) == 3 & length(test.9$points) == 3 & length(test.9$who_is_after) == 3, TRUE)

print("Test 2: if fail, incorrect elements in a list.", quote = FALSE)
stopifnot(test.9$name[3] == 'snitch' & test.9$points[3] == 150 & test.9$who_is_after[3] == 'seeker', TRUE)
```

